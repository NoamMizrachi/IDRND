<html lang="en">
  <head>
    <meta charset="utf-8" />
    <script src="../dist/idrndSdk.js"></script>
    <style>
      .main-container {
        display: flex;
        margin-bottom: 15px;
      }
      .container {
        margin-bottom: 15px;
      }
    </style>
  </head>

  <body>
    <div class="main-container">
      <!-- XLSX Input -->
      <div class="container">
        <label for="xlsxInput">Upload xlsx file:</label><br /><br />
        <input type="file" id="xlsxInput" name="xlsxInput" /><br /><br />
        <input
          type="submit"
          value="Submit xlsx"
          onclick="return onSubmitXlsx();"
        /><br /><br />
      </div>
      <!-- Images Input -->
      <div class="container">
        <label for="imagesInput">Upload multiple images</label><br /><br />
        <input
          type="file"
          id="imagesInput"
          name="imagesInput"
          multiple
        /><br /><br />
        <input
          type="submit"
          value="Submit images"
          onclick="return onSubmitImages();"
        /><br /><br />
      </div>
    </div>

    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script type="text/babel" data-presets="es2015,stage-2">
      const sdkRef = sdk();
      const imagesInput = document.getElementById("imagesInput");
      const xlsxInput = document.getElementById("xlsxInput");

      imagesInput.addEventListener("change", function() {
        const files = this.files;
        let counter = 0;
        let interval = setInterval(function() {
          if (counter < files.length) {
            counter++;
            ///////////////
            const reader = new FileReader();
            reader.addEventListener("load", function() {
              console.log(files[counter]);

              //////////////////////////////do something
              var myHeaders = new Headers();
              myHeaders.append("Access-Control-Allow-Origin", "*");
              myHeaders.append("TOKEN", "AU10TIX");
              myHeaders.append(
                "Cookie",
                "JSESSIONID=BB19D77F465198B6A15733D29165CB7A"
              );

              var formdata = new FormData();
              formdata.append("file", this.result);
              var requestOptions = {
                method: "POST",
                mode: 'no-cors', 
                headers: myHeaders,
                body: formdata,
                redirect: "follow"
              };

              fetch("http://18.144.71.78:8080/check_liveness", requestOptions)
                .then(response => response.json())
                .then(data => alert(data))
                .catch(error => alert("error!!!", error));

              ////////////////////////////end
            });
            reader.readAsDataURL(files[counter]);
            ///////////////////
          } else {
            clearInterval(interval);
          }
        }, 5000);
      });

      function onSubmitXlsx() {
        // alert("Submit button clicked!");
        let toAlert = sdkRef.getFirstCell(xlsxFileFromUpload);
        alert(toAlert);
        return true;
      }
      function onSubmitImages() {
        const imagesInput = document.querySelector("#imagesInput");
        let imageBase64 = imagesInput.src;
        alert(imageBase64);
        return true;
      }
    </script>
  </body>
</html>
